<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carafina Quotation Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  * { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
  }
  
  body { 
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
    color: #2d3748;
    line-height: 1.6;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: stretch;
  }
  
  .form-container {
    background: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    min-height: 600px;
    display: flex;
    flex-direction: column;
  }
  
  .quote-box {
    background: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    height: 660px;
    display: flex;
    flex-direction: column;
    position: sticky;
    top: 0;
  }
  
  .header {
    text-align: center;
    margin-bottom: 10px;
    grid-column: 1 / -1;
  }
  
  .header h1 {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  
  .button-row {
    display: flex;
    justify-content: center;
    margin-top: auto;
    flex-shrink: 0;
  }
  
  .button-row .btn {
    margin-bottom: 0;
  }
  
  
  .form-group {
    margin-bottom: 25px;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  
  .disabled-field {
    opacity: 0.5;
    pointer-events: none;
    background-color: #f8f9fa;
    border-color: #e9ecef;
  }
  
  .disabled-field .input-hint {
    color: #6c757d;
    font-style: italic;
  }
  
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #4a5568;
    font-size: 0.95rem;
  }
  
  .input-wrapper {
    position: relative;
  }
  
  input, select {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #f8fafc;
  }
  
  input:focus, select:focus {
    outline: none;
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-2px);
  }
  
  
  .measurement-section {
    background: #f0f9ff;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 25px;
    border: 2px solid #e0f2fe;
  }

  .measurement-section h3 {
    color: #0369a1;
    margin-bottom: 15px;
    font-size: 1.1rem;
  }

  .input-hint {
    font-size: 0.8rem;
    color: #64748b;
    margin-top: 5px;
    font-style: italic;
  }


  .error-message {
    color: #dc2626;
    font-size: 0.8rem;
    margin-top: 5px;
    display: none;
  }

  .error-message.show {
    display: block;
  }

  .input-wrapper.error input {
    border-color: #dc2626;
    background: #fef2f2;
  }

  .rate-section {
    background: #f7fafc;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 25px;
  }
  
  .custom-rate {
    margin-top: 15px;
    display: none;
  }
  
  .custom-rate.show {
    display: block;
  }
  
  .btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-decoration: none;
    margin-bottom: 15px;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
  }
  
  .btn-secondary {
    background: #48bb78;
    color: white;
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
  }
  
  .btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(72, 187, 120, 0.6);
  }
  
  .unit-dropdown {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    background: #f8fafc;
    transition: all 0.3s ease;
  }
  
  .unit-dropdown:focus {
    outline: none;
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .quote-header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e2e8f0;
  }
  
  .quote-header h3 {
    font-size: 2rem;
    color: #2d3748;
    margin-bottom: 10px;
  }
  
  .quote-header p {
    color: #718096;
    font-size: 1.1rem;
  }
  
  .quote-details {
    display: grid;
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: #f7fafc;
    border-radius: 10px;
    border-left: 4px solid #667eea;
  }
  
  .detail-label {
    font-weight: 600;
    color: #4a5568;
    font-size: 0.9rem;
  }
  
  .detail-value {
    font-weight: 700;
    color: #2d3748;
    font-size: 0.95rem;
  }
  
  .total-section {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    margin-top: auto;
    flex-shrink: 0;
    margin-bottom: 0;
  }
  
  .total-section h4 {
    font-size: 1.2rem;
    margin-bottom: 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    display: inline;
  }
  
  .total-section p {
    font-size: 0.8rem;
    opacity: 0.9;
    display: inline;
    margin-left: 10px;
  }
  
  .hidden {
    display: none;
  }
  
  
  @media (max-width: 768px) {
    .container {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .form-row {
      grid-template-columns: 1fr;
    }
    
    
    .button-row {
      flex-direction: column;
    }
    
    .header h1 {
      font-size: 2rem;
    }
    
    .form-container, .quote-box {
      padding: 25px;
    }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1><i class="fas fa-calculator"></i> Carafina Quotation Generator</h1>
  </div>

  <div class="form-container">
    <div class="measurement-section">
      <h3><i class="fas fa-ruler-combined"></i> Measurements</h3>
      
      <div class="form-group">
        <label><i class="fas fa-cog"></i> Select Measurement Unit</label>
        <select class="unit-dropdown" id="unitDropdown">
          <option value="ft">Feet (ft)</option>
          <option value="m">Meters (m)</option>
          <option value="cm">Centimeters (cm)</option>
          <option value="mm">Millimeters (mm)</option>
          <option value="running_ft">Running Feet (ft)</option>
        </select>
      </div>
      
      <div class="form-group">
        <div class="form-row" id="measurementInputs">
          <div>
            <label><i class="fas fa-ruler-horizontal"></i> Length</label>
            <div class="input-wrapper">
              <input type="text" id="length" placeholder="Enter length" autocomplete="off">
            </div>
            <div class="input-hint" id="lengthHint">Enter length in the selected unit</div>
          </div>
          <div id="widthContainer">
            <label><i class="fas fa-ruler-vertical"></i> Width</label>
            <div class="input-wrapper">
              <input type="text" id="width" placeholder="Enter width" autocomplete="off">
            </div>
            <div class="input-hint" id="widthHint">Enter width in the selected unit</div>
          </div>
        </div>
      </div>
    </div>

    <div class="rate-section">
      <label><i class="fas fa-tags"></i> Material Type & Rate</label>
      <select class="unit-dropdown" id="materialDropdown">
        <option value="ply_aluminium_glass">16mm Ply Aluminium & Glass - ₹4,500/sqft</option>
        <option value="ply_laminate_12mm">12mm Ply Laminate - ₹1,800/sqft</option>
        <option value="duco_beading">Duco Beading - ₹3,500/running ft</option>
        <option value="ply_cnc_design">16mm Ply CNC Design - ₹3,000/sqft</option>
        <option value="ply_laminate_16mm">16mm Ply Laminate - ₹2,700/sqft</option>
        <option value="ply_louver">12mm Ply Louver - ₹2,100/sqft</option>
        <option value="ply_mdf">12mm Ply MDF - ₹1,500/sqft</option>
        <option value="ply_12mm">12mm Ply - ₹2,100/sqft</option>
        <option value="fluted_panel">Fluted Panel - ₹2,100/sqft</option>
        <option value="marine_ply_acrylic">16mm Marine Ply Acrylic - ₹3,500/sqft</option>
        <option value="marine_ply_rehau">16mm Marine Ply Rehau - ₹3,500/sqft</option>
        <option value="marine_ply_laminate">16mm Marine Ply Laminate - ₹3,000/sqft</option>
        <option value="custom">Custom Rate - Set your own</option>
      </select>
      <div class="custom-rate" id="customRateInput">
        <div class="form-row">
          <div>
            <label><i class="fas fa-rupee-sign"></i> Custom Rate</label>
            <div class="input-wrapper">
              <input type="number" id="customRate" placeholder="Enter custom rate" step="0.01">
            </div>
          </div>
          <div>
            <label><i class="fas fa-ruler-combined"></i> Rate Unit</label>
            <div class="input-wrapper">
              <select id="customRateUnit">
                <option value="sqft">Per Square Feet (sq.ft)</option>
                <option value="sqm">Per Square Meter (sq.m)</option>
                <option value="running_ft">Per Running Feet (ft)</option>
              </select>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div>
            <label><i class="fas fa-tag"></i> Material Name</label>
            <div class="input-wrapper">
              <input type="text" id="customMaterialName" placeholder="Enter material name">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="button-row">
      <button class="btn btn-primary" onclick="generateQuote()">
        <i class="fas fa-calculator"></i>
        Generate Quotation
      </button>
    </div>
  </div>

  <div class="quote-box hidden" id="quoteBox">
    <div class="quote-header">
      <h3><i class="fas fa-file-invoice"></i> Quotation Details</h3>
      <p>Generated on <span id="currentDate"></span></p>
    </div>
    <div class="quote-details" id="quoteDetails"></div>
    <div class="total-section" id="totalSection"></div>
  </div>
</div>


<script>
  // Material rates mapping
  const rateMapping = {
    "ply_aluminium_glass": { rate: 4500, unit: "sqft", name: "16mm Ply Aluminium & Glass Finish" },
    "ply_laminate_12mm": { rate: 1800, unit: "sqft", name: "12mm Ply Laminate Finish" },
    "duco_beading": { rate: 3500, unit: "running_ft", name: "Duco Beading" },
    "ply_cnc_design": { rate: 3000, unit: "sqft", name: "16mm Ply CNC Design" },
    "ply_laminate_16mm": { rate: 2700, unit: "sqft", name: "16mm Ply Laminate Finish" },
    "ply_louver": { rate: 2100, unit: "sqft", name: "12mm Ply Louver Finish" },
    "ply_mdf": { rate: 1500, unit: "sqft", name: "12mm Ply MDF Finish" },
    "ply_12mm": { rate: 2100, unit: "sqft", name: "12mm Ply" },
    "fluted_panel": { rate: 2100, unit: "sqft", name: "Fluted Panel" },
    "marine_ply_acrylic": { rate: 3500, unit: "sqft", name: "16mm Marine Ply Acrylic Finish" },
    "marine_ply_rehau": { rate: 3500, unit: "sqft", name: "16mm Marine Ply Rehau Finish" },
    "marine_ply_laminate": { rate: 3000, unit: "sqft", name: "16mm Marine Ply Laminate Finish" }
  };

  let selectedRate = "ply_laminate_12mm";
  let selectedUnit = "ft";

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
    // Set current date
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    
    // Select default rate
    selectRate('ply_laminate_12mm');
    
    // Initialize measurement inputs
    updateMeasurementInputs();
    
    // Add input event listeners for real-time validation
    document.getElementById('length').addEventListener('input', function() {
      clearErrors('length');
      validateMeasurement('length');
    });
    document.getElementById('width').addEventListener('input', function() {
      clearErrors('width');
      validateMeasurement('width');
    });
    
    // Add dropdown event listeners
    document.getElementById('unitDropdown').addEventListener('change', function() {
      selectUnit(this.value);
    });
    
    document.getElementById('materialDropdown').addEventListener('change', function() {
      selectRate(this.value);
    });
  });

  function selectRate(rate) {
    selectedRate = rate;
    
    // Update dropdown value
    document.getElementById('materialDropdown').value = rate;
    
    // Show/hide custom rate input
    const customRateInput = document.getElementById('customRateInput');
    if (rate === 'custom') {
      customRateInput.classList.add('show');
    } else {
      customRateInput.classList.remove('show');
    }
    
    // Update unit options based on material type
    updateUnitOptions();
  }

  function updateUnitOptions() {
    const unitDropdown = document.getElementById('unitDropdown');
    const materialInfo = selectedRate === 'custom' ? 
      { unit: document.getElementById('customRateUnit')?.value || 'sqft' } : 
      rateMapping[selectedRate];
    
    // Set the selected value in dropdown
    unitDropdown.value = selectedUnit;
  }

  function selectUnit(unit) {
    selectedUnit = unit;
    
    // Update placeholders and hints based on selected unit
    updateInputPlaceholders();
    
    // Show/hide width input based on unit type
    updateMeasurementInputs();
    
    // Clear any existing errors
    clearErrors('length');
    clearErrors('width');
  }

  function updateMeasurementInputs() {
    const widthContainer = document.getElementById('widthContainer');
    const widthInput = document.getElementById('width');
    const widthHint = document.getElementById('widthHint');
    
    if (selectedUnit === 'running_ft') {
      // Gray out width for running feet
      widthContainer.classList.add('disabled-field');
      widthInput.value = ''; // Clear width value
      widthHint.textContent = 'Width not needed for running feet';
    } else {
      // Enable width for area measurements
      widthContainer.classList.remove('disabled-field');
      widthHint.textContent = `Enter width in ${selectedUnit === 'ft' ? 'feet' : selectedUnit === 'm' ? 'meters' : selectedUnit === 'cm' ? 'centimeters' : 'millimeters'}`;
    }
  }

  function updateInputPlaceholders() {
    const lengthInput = document.getElementById('length');
    const widthInput = document.getElementById('width');
    const lengthHint = document.getElementById('lengthHint');
    const widthHint = document.getElementById('widthHint');
    
    const examples = {
      'ft': '5ft, 5\'10", 5ft 10in',
      'm': '2.5m, 1.8m',
      'cm': '150cm, 120cm',
      'mm': '1500mm, 1200mm',
      'running_ft': '5ft, 5\'10", 5ft 10in'
    };
    
    const unitLabels = {
      'ft': 'feet',
      'm': 'meters',
      'cm': 'centimeters',
      'mm': 'millimeters',
      'running_ft': 'running feet'
    };
    
    lengthInput.placeholder = `e.g., ${examples[selectedUnit]}`;
    widthInput.placeholder = `e.g., ${examples[selectedUnit]}`;
    lengthHint.textContent = `Enter length in ${unitLabels[selectedUnit]}`;
    widthHint.textContent = `Enter width in ${unitLabels[selectedUnit]}`;
  }

  // Unit-specific measurement parser
  function parseMeasurement(input, targetUnit) {
    if (!input || typeof input !== 'string') return { value: 0, error: 'Invalid input' };
    
    const cleanInput = input.trim().toLowerCase();
    
    // Unit-specific patterns
    const patterns = {
      'ft': [
        // Feet and inches: 5ft 10in, 5'10", 5 feet 10 inches, 5 ft 10 in, 10' 11''
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')\s*(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) + parseFloat(match[2]) / 12 },
        // Feet only: 5ft, 5', 5 feet
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')/i, 
          handler: (match) => parseFloat(match[1]) },
        // Inches only: 10in, 10", 10 inches
        { regex: /(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) / 12 },
        // Pure numbers (assume feet)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'm': [
        // Meters: 2.5m, 2.5 meters
        { regex: /(\d+(?:\.\d+)?)\s*(?:m|meters?)/i, 
          handler: (match) => parseFloat(match[1]) },
        // Pure numbers (assume meters)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'cm': [
        // Centimeters: 150cm, 150 centimeters
        { regex: /(\d+(?:\.\d+)?)\s*(?:cm|centimeters?)/i, 
          handler: (match) => parseFloat(match[1]) },
        // Pure numbers (assume cm)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'mm': [
        // Millimeters: 1500mm, 1500 millimeters
        { regex: /(\d+(?:\.\d+)?)\s*(?:mm|millimeters?)/i, 
          handler: (match) => parseFloat(match[1]) },
        // Pure numbers (assume mm)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'running_ft': [
        // Feet and inches: 5ft 10in, 5'10", 5 feet 10 inches, 5 ft 10 in, 10' 11''
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')\s*(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) + parseFloat(match[2]) / 12 },
        // Feet only: 5ft, 5', 5 feet
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')/i, 
          handler: (match) => parseFloat(match[1]) },
        // Inches only: 10in, 10", 10 inches
        { regex: /(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) / 12 },
        // Pure numbers (assume feet)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ]
    };
    
    const unitPatterns = patterns[targetUnit] || patterns['ft'];
    
    for (const pattern of unitPatterns) {
      const match = cleanInput.match(pattern.regex);
      if (match) {
        const value = pattern.handler(match);
        if (!isNaN(value) && value > 0) {
          return { value, error: null };
        }
      }
    }
    
    const examples = {
      'ft': '5ft, 5\'10", 5ft 10in, 10in',
      'm': '2.5m, 1.8m',
      'cm': '150cm, 120cm',
      'mm': '1500mm, 1200mm',
      'running_ft': '5ft, 5\'10", 5ft 10in, 10in'
    };
    
    return { 
      value: 0, 
      error: `Invalid format. Try: ${examples[targetUnit]}` 
    };
  }

  function clearErrors(field) {
    const input = document.getElementById(field);
    const wrapper = input.parentElement;
    const hint = wrapper.parentElement.querySelector('.input-hint');
    
    // Remove error styling
    wrapper.classList.remove('error');
    
    // Remove error message
    const existingError = wrapper.parentElement.querySelector('.error-message');
    if (existingError) {
      existingError.remove();
    }
    
    // Reset hint based on field and unit
    if (field === 'width' && selectedUnit === 'running_ft') {
      hint.textContent = 'Width not needed for running feet';
      hint.style.color = '#6c757d';
    } else {
      const unitLabels = {
        'ft': 'feet',
        'm': 'meters',
        'cm': 'centimeters',
        'mm': 'millimeters',
        'running_ft': 'running feet'
      };
      hint.textContent = `Enter ${field} in ${unitLabels[selectedUnit]}`;
      hint.style.color = '#64748b';
    }
  }

  function validateMeasurement(field) {
    const input = document.getElementById(field);
    const value = input.value;
    
    // Skip validation if width field is disabled (running feet)
    if (field === 'width' && selectedUnit === 'running_ft') {
      return true;
    }
    
    if (!value.trim()) {
      return true; // Empty is valid
    }
    
    const result = parseMeasurement(value, selectedUnit);
    
    if (result.error) {
      // Add error styling
      input.parentElement.classList.add('error');
      
      // Add error message
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message show';
      errorDiv.textContent = result.error;
      input.parentElement.parentElement.appendChild(errorDiv);
      
      return false;
    } else {
      // Show success hint
      const hint = input.parentElement.parentElement.querySelector('.input-hint');
      hint.textContent = `✓ Parsed as ${result.value.toFixed(2)} ${selectedUnit}`;
      hint.style.color = '#059669';
      
      return true;
    }
  }

  // Convert any unit to feet
  function convertToFeet(value, unit) {
    const conversions = {
      "mm": value / 304.8,      // 1 foot = 304.8 mm
      "cm": value / 30.48,      // 1 foot = 30.48 cm
      "m": value * 3.28084,     // 1 meter = 3.28084 feet
      "in": value / 12,         // 1 foot = 12 inches
      "ft": value,              // already in feet
      "running_ft": value       // running feet are the same as regular feet
    };
    return conversions[unit] || value;
  }

  // Convert any unit to meters
  function convertToMeters(value, unit) {
    const conversions = {
      "mm": value / 1000,       // 1 meter = 1000 mm
      "cm": value / 100,        // 1 meter = 100 cm
      "m": value,               // already in meters
      "in": value * 0.0254,     // 1 inch = 0.0254 meters
      "ft": value * 0.3048      // 1 foot = 0.3048 meters
    };
    return conversions[unit] || value;
  }

  // Helper function to determine if conversion display is needed
  function getConversionDisplay(inputUnit, materialUnit, convertedValue) {
    let targetUnit;
    if (materialUnit === 'running_ft') {
      targetUnit = 'ft';
    } else if (materialUnit === 'sqm') {
      targetUnit = 'm';
    } else if (materialUnit === 'sqft') {
      targetUnit = 'ft';
    } else {
      targetUnit = 'ft'; // Default to feet
    }
    
    // Only show conversion if input unit is different from target unit
    if (inputUnit !== targetUnit) {
      return ` (${convertedValue.toFixed(2)} ${targetUnit})`;
    }
    return '';
  }

  function generateQuote() {
    // Parse measurements using unit-specific parser
    const lengthInput = document.getElementById("length").value;
    const widthInput = document.getElementById("width").value;
    
    const lengthResult = parseMeasurement(lengthInput, selectedUnit);
    const widthResult = parseMeasurement(widthInput, selectedUnit);
    
    // Check for parsing errors
    if (lengthResult.error) {
      alert(`Length error: ${lengthResult.error}`);
      return;
    }
    if (widthResult.error) {
      alert(`Width error: ${widthResult.error}`);
      return;
    }
    
    // Get parsed values in the selected unit
    const lengthInUnit = lengthResult.value;
    const widthInUnit = selectedUnit === 'running_ft' ? 0 : widthResult.value; // No width for running feet
    
    if (lengthInUnit <= 0) {
      alert("Please enter a valid length greater than zero.");
      return;
    }
    
    if (selectedUnit !== 'running_ft' && widthInUnit <= 0) {
      alert("Please enter a valid width greater than zero.");
      return;
    }
    
    // Get material info for unit validation
    let materialInfo;
    if (selectedRate === "custom") {
      const customRate = parseFloat(document.getElementById("customRate").value);
      const customRateUnit = document.getElementById("customRateUnit").value;
      const customMaterialName = document.getElementById("customMaterialName").value;
      
      if (isNaN(customRate) || customRate <= 0) {
        alert("Please enter a valid custom rate.");
        return;
      }
      
      materialInfo = {
        rate: customRate,
        unit: customRateUnit,
        name: customMaterialName || "Custom Material"
      };
    } else {
      materialInfo = rateMapping[selectedRate];
    }
    
    // Smart unit validation - all units are now linear, but we need to check if material requires area calculation
    const isLinearMaterial = materialInfo.unit === 'running_ft';
    const isAreaMaterial = materialInfo.unit === 'sqft' || materialInfo.unit === 'sqm';
    
    if (isLinearMaterial && selectedUnit === 'running_ft') {
      // This is correct - linear material with linear unit
    } else if (isLinearMaterial && selectedUnit !== 'running_ft') {
      // Linear material but non-linear input unit
      alert(`❌ Unit Mismatch!\n\nThis material (${materialInfo.name}) is priced per running foot, but you selected an area unit (${selectedUnit}).\n\nPlease select "Running Feet" for linear measurements.`);
      return;
    } else if (isAreaMaterial) {
      // Area materials need both length and width (except for running_ft unit which is handled separately)
      if (selectedUnit === 'running_ft') {
        alert(`❌ Unit Mismatch!\n\nThis material (${materialInfo.name}) is priced per square foot, but you selected a linear unit (${selectedUnit}).\n\nPlease select a linear unit like "Feet", "Meters", "Centimeters", or "Millimeters" for area measurements.`);
        return;
      }
    }
    
    // Smart unit conversion - only convert when necessary
    let lengthInTargetUnit, widthInTargetUnit, areaInTargetUnit, cost, calculationMethod;
    
    if (materialInfo.unit === "running_ft") {
      // For running feet materials, convert to feet
      lengthInTargetUnit = convertToFeet(lengthInUnit, selectedUnit);
      cost = lengthInTargetUnit * materialInfo.rate;
      calculationMethod = `Length: ${lengthInTargetUnit.toFixed(2)} ft × ₹${materialInfo.rate.toLocaleString()}/ft`;
    } else if (materialInfo.unit === "sqm") {
      // For sq.m materials, convert to meters
      lengthInTargetUnit = convertToMeters(lengthInUnit, selectedUnit);
      widthInTargetUnit = convertToMeters(widthInUnit, selectedUnit);
      areaInTargetUnit = lengthInTargetUnit * widthInTargetUnit;
      cost = areaInTargetUnit * materialInfo.rate;
      calculationMethod = `Area: ${areaInTargetUnit.toFixed(2)} sq.m × ₹${materialInfo.rate.toLocaleString()}/sq.m`;
    } else if (materialInfo.unit === "sqft") {
      // For sq.ft materials, convert to feet
      lengthInTargetUnit = convertToFeet(lengthInUnit, selectedUnit);
      widthInTargetUnit = convertToFeet(widthInUnit, selectedUnit);
      areaInTargetUnit = lengthInTargetUnit * widthInTargetUnit;
      cost = areaInTargetUnit * materialInfo.rate;
      calculationMethod = `Area: ${areaInTargetUnit.toFixed(2)} sq.ft × ₹${materialInfo.rate.toLocaleString()}/sq.ft`;
    } else {
      // Default case - treat as sq.ft
      lengthInTargetUnit = convertToFeet(lengthInUnit, selectedUnit);
      widthInTargetUnit = convertToFeet(widthInUnit, selectedUnit);
      areaInTargetUnit = lengthInTargetUnit * widthInTargetUnit;
      cost = areaInTargetUnit * materialInfo.rate;
      calculationMethod = `Area: ${areaInTargetUnit.toFixed(2)} sq.ft × ₹${materialInfo.rate.toLocaleString()}/sq.ft`;
    }

    // Update quote details
    const quoteDetails = document.getElementById('quoteDetails');
    quoteDetails.innerHTML = `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-cube"></i> Material</span>
        <span class="detail-value">${materialInfo.name}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-ruler-horizontal"></i> Length</span>
        <span class="detail-value">${lengthInUnit.toFixed(2)} ${selectedUnit}${getConversionDisplay(selectedUnit, materialInfo.unit, lengthInTargetUnit)}</span>
      </div>
      ${selectedUnit !== 'running_ft' ? `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-ruler-vertical"></i> Width</span>
        <span class="detail-value">${widthInUnit.toFixed(2)} ${selectedUnit}${getConversionDisplay(selectedUnit, materialInfo.unit, widthInTargetUnit)}</span>
      </div>
      ` : ''}
      ${materialInfo.unit === 'running_ft' ? `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-ruler-combined"></i> Total Length</span>
        <span class="detail-value">${lengthInTargetUnit.toFixed(2)} ft</span>
      </div>
      ` : `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-expand-arrows-alt"></i> Area</span>
        <span class="detail-value">${areaInTargetUnit.toFixed(2)} ${materialInfo.unit === 'sqm' ? 'sq.m' : 'sq.ft'}</span>
      </div>
      `}
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-tag"></i> Rate</span>
        <span class="detail-value">₹${materialInfo.rate.toLocaleString()}/${materialInfo.unit === 'running_ft' ? 'ft' : materialInfo.unit === 'sqm' ? 'sq.m' : 'sq.ft'}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-calculator"></i> Calculation</span>
        <span class="detail-value">${calculationMethod}</span>
      </div>
    `;

    // Update total section
    const totalSection = document.getElementById('totalSection');
    totalSection.innerHTML = `
      <h4>₹${cost.toLocaleString()}</h4>
      <p>Total Cost</p>
    `;

    // Show quote box with animation
    const quoteBox = document.getElementById('quoteBox');
    quoteBox.classList.remove('hidden');
    quoteBox.classList.add('fade-in');
    
  }


</script>
</body>
</html>
