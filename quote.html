<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Quotation Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  * { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
  }
  
  body { 
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
    color: #2d3748;
    line-height: 1.6;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: start;
  }
  
  .header {
    text-align: center;
    margin-bottom: 40px;
    grid-column: 1 / -1;
  }
  
  .header h1 {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
  }
  
  .header p {
    font-size: 1.2rem;
    color: rgba(255,255,255,0.9);
    font-weight: 300;
  }
  
  .form-container {
    background: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
  }
  
  .form-group {
    margin-bottom: 25px;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  
  .form-row.single-input {
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  
  .form-row.single-input > div {
    max-width: none;
    width: 100%;
  }
  
  .disabled-field {
    opacity: 0.5;
    pointer-events: none;
    background-color: #f8f9fa;
    border-color: #e9ecef;
  }
  
  .disabled-field .input-hint {
    color: #6c757d;
    font-style: italic;
  }
  
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #4a5568;
    font-size: 0.95rem;
  }
  
  .input-wrapper {
    position: relative;
  }
  
  input, select {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #f8fafc;
  }
  
  input:focus, select:focus {
    outline: none;
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    transform: translateY(-2px);
  }
  
  .input-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #a0aec0;
    font-size: 18px;
  }
  
  .measurement-section {
    background: #f0f9ff;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 25px;
    border: 2px solid #e0f2fe;
  }

  .measurement-section h3 {
    color: #0369a1;
    margin-bottom: 20px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .input-hint {
    font-size: 0.8rem;
    color: #64748b;
    margin-top: 5px;
    font-style: italic;
  }

  .unit-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 10px;
  }
  
  @media (max-width: 768px) {
    .unit-options {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (max-width: 480px) {
    .unit-options {
      grid-template-columns: 1fr;
    }
  }

  .unit-option {
    padding: 8px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    font-size: 0.9rem;
    font-weight: 500;
  }

  .unit-option:hover {
    border-color: #0369a1;
    background: #f0f9ff;
  }

  .unit-option.selected {
    border-color: #0369a1;
    background: #0369a1;
    color: white;
  }

  .error-message {
    color: #dc2626;
    font-size: 0.8rem;
    margin-top: 5px;
    display: none;
  }

  .error-message.show {
    display: block;
  }

  .input-wrapper.error input {
    border-color: #dc2626;
    background: #fef2f2;
  }

  .rate-section {
    background: #f7fafc;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 25px;
  }
  
  .rate-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-bottom: 15px;
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: #fafbfc;
  }
  
  .rate-option {
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
  }
  
  .rate-option:hover {
    border-color: #667eea;
    transform: translateY(-2px);
  }
  
  .rate-option.selected {
    border-color: #667eea;
    background: #667eea;
    color: white;
  }
  
  .rate-option h4 {
    font-size: 0.9rem;
    margin-bottom: 4px;
  }
  
  .rate-option p {
    font-size: 0.8rem;
    opacity: 0.8;
  }
  
  .custom-rate {
    margin-top: 15px;
    display: none;
  }
  
  .custom-rate.show {
    display: block;
    animation: slideDown 0.3s ease;
  }
  
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-decoration: none;
    margin-bottom: 15px;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
  }
  
  .btn-secondary {
    background: #48bb78;
    color: white;
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
  }
  
  .btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(72, 187, 120, 0.6);
  }
  
  .quote-box {
    background: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  .quote-header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid #e2e8f0;
  }
  
  .quote-header h3 {
    font-size: 2rem;
    color: #2d3748;
    margin-bottom: 10px;
  }
  
  .quote-header p {
    color: #718096;
    font-size: 1.1rem;
  }
  
  .quote-details {
    display: grid;
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: #f7fafc;
    border-radius: 10px;
    border-left: 4px solid #667eea;
  }
  
  .detail-label {
    font-weight: 600;
    color: #4a5568;
  }
  
  .detail-value {
    font-weight: 700;
    color: #2d3748;
    font-size: 1.1rem;
  }
  
  .total-section {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    text-align: center;
    margin-top: 20px;
  }
  
  .total-section h4 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  .total-section p {
    font-size: 1.2rem;
    opacity: 0.9;
  }
  
  .hidden {
    display: none;
  }
  
  .fade-in {
    animation: fadeIn 0.5s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @media (max-width: 768px) {
    .container {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .form-row {
      grid-template-columns: 1fr;
    }
    
    .rate-options {
      grid-template-columns: 1fr 1fr;
    }
    
    .header h1 {
      font-size: 2rem;
    }
    
    .form-container, .quote-box {
      padding: 25px;
    }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1><i class="fas fa-calculator"></i> Carafina Quotation Generator</h1>
    <p>Create accurate material cost estimates in seconds</p>
  </div>

  <div class="form-container">
    <div class="measurement-section">
      <h3><i class="fas fa-ruler-combined"></i> Measurements</h3>
      
      <div class="form-group">
        <label><i class="fas fa-cog"></i> Select Measurement Unit</label>
        <div class="unit-options" id="unitOptions">
          <!-- Units will be populated dynamically based on material type -->
        </div>
      </div>
      
      <div class="form-group">
        <div class="form-row" id="measurementInputs">
          <div>
            <label><i class="fas fa-ruler-horizontal"></i> Length</label>
            <div class="input-wrapper">
              <input type="text" id="length" placeholder="Enter length" autocomplete="off">
              <i class="fas fa-ruler input-icon"></i>
            </div>
            <div class="input-hint" id="lengthHint">Enter length in the selected unit</div>
          </div>
          <div id="widthContainer">
            <label><i class="fas fa-ruler-vertical"></i> Width</label>
            <div class="input-wrapper">
              <input type="text" id="width" placeholder="Enter width" autocomplete="off">
              <i class="fas fa-ruler input-icon"></i>
            </div>
            <div class="input-hint" id="widthHint">Enter width in the selected unit</div>
          </div>
        </div>
      </div>
    </div>

    <div class="rate-section">
      <label><i class="fas fa-tags"></i> Material Type & Rate</label>
      <div class="rate-options">
        <div class="rate-option" data-rate="ply_aluminium_glass" onclick="selectRate('ply_aluminium_glass')">
          <h4>16mm Ply Aluminium & Glass</h4>
          <p>₹4,500/sqft</p>
        </div>
        <div class="rate-option" data-rate="ply_laminate_12mm" onclick="selectRate('ply_laminate_12mm')">
          <h4>12mm Ply Laminate</h4>
          <p>₹1,800/sqft</p>
        </div>
        <div class="rate-option" data-rate="duco_beading" onclick="selectRate('duco_beading')">
          <h4>Duco Beading</h4>
          <p>₹3,500/running ft</p>
        </div>
        <div class="rate-option" data-rate="ply_cnc_design" onclick="selectRate('ply_cnc_design')">
          <h4>16mm Ply CNC Design</h4>
          <p>₹3,000/sqft</p>
        </div>
        <div class="rate-option" data-rate="ply_laminate_16mm" onclick="selectRate('ply_laminate_16mm')">
          <h4>16mm Ply Laminate</h4>
          <p>₹2,700/sqft</p>
        </div>
        <div class="rate-option" data-rate="ply_louver" onclick="selectRate('ply_louver')">
          <h4>12mm Ply Louver</h4>
          <p>₹2,100/sqft</p>
        </div>
        <div class="rate-option" data-rate="ply_mdf" onclick="selectRate('ply_mdf')">
          <h4>12mm Ply MDF</h4>
          <p>₹1,500/sqft</p>
        </div>
        <div class="rate-option" data-rate="ply_12mm" onclick="selectRate('ply_12mm')">
          <h4>12mm Ply</h4>
          <p>₹2,100/sqft</p>
        </div>
        <div class="rate-option" data-rate="fluted_panel" onclick="selectRate('fluted_panel')">
          <h4>Fluted Panel</h4>
          <p>₹2,100/sqft</p>
        </div>
        <div class="rate-option" data-rate="marine_ply_acrylic" onclick="selectRate('marine_ply_acrylic')">
          <h4>16mm Marine Ply Acrylic</h4>
          <p>₹3,500/sqft</p>
        </div>
        <div class="rate-option" data-rate="marine_ply_rehau" onclick="selectRate('marine_ply_rehau')">
          <h4>16mm Marine Ply Rehau</h4>
          <p>₹3,500/sqft</p>
        </div>
        <div class="rate-option" data-rate="marine_ply_laminate" onclick="selectRate('marine_ply_laminate')">
          <h4>16mm Marine Ply Laminate</h4>
          <p>₹3,000/sqft</p>
        </div>
        <div class="rate-option" data-rate="custom" onclick="selectRate('custom')">
          <h4>Custom Rate</h4>
          <p>Set your own</p>
        </div>
      </div>
      <div class="custom-rate" id="customRateInput">
        <div class="form-row">
          <div>
            <label><i class="fas fa-rupee-sign"></i> Custom Rate</label>
            <div class="input-wrapper">
              <input type="number" id="customRate" placeholder="Enter custom rate" step="0.01">
              <i class="fas fa-rupee-sign input-icon"></i>
            </div>
          </div>
          <div>
            <label><i class="fas fa-ruler-combined"></i> Rate Unit</label>
            <div class="input-wrapper">
              <select id="customRateUnit">
                <option value="sqft">Per Square Feet (sq.ft)</option>
                <option value="sqm">Per Square Meter (sq.m)</option>
                <option value="running_ft">Per Running Feet (ft)</option>
              </select>
              <i class="fas fa-chevron-down input-icon"></i>
            </div>
          </div>
        </div>
        <div>
          <label><i class="fas fa-tag"></i> Material Name</label>
          <div class="input-wrapper">
            <input type="text" id="customMaterialName" placeholder="Enter material name">
            <i class="fas fa-cube input-icon"></i>
          </div>
        </div>
      </div>
    </div>

    <button class="btn btn-primary" onclick="generateQuote()">
      <i class="fas fa-calculator"></i>
      Generate Quotation
    </button>
    <button class="btn btn-secondary" onclick="downloadPDF()">
      <i class="fas fa-download"></i>
      Download as PDF
    </button>
  </div>

  <div class="quote-box hidden" id="quoteBox">
    <div class="quote-header">
      <h3><i class="fas fa-file-invoice"></i> Quotation Details</h3>
      <p>Generated on <span id="currentDate"></span></p>
    </div>
    <div class="quote-details" id="quoteDetails"></div>
    <div class="total-section" id="totalSection"></div>
  </div>
</div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  // Material rates mapping
  const rateMapping = {
    "ply_aluminium_glass": { rate: 4500, unit: "sqft", name: "16mm Ply Aluminium & Glass Finish" },
    "ply_laminate_12mm": { rate: 1800, unit: "sqft", name: "12mm Ply Laminate Finish" },
    "duco_beading": { rate: 3500, unit: "running_ft", name: "Duco Beading" },
    "ply_cnc_design": { rate: 3000, unit: "sqft", name: "16mm Ply CNC Design" },
    "ply_laminate_16mm": { rate: 2700, unit: "sqft", name: "16mm Ply Laminate Finish" },
    "ply_louver": { rate: 2100, unit: "sqft", name: "12mm Ply Louver Finish" },
    "ply_mdf": { rate: 1500, unit: "sqft", name: "12mm Ply MDF Finish" },
    "ply_12mm": { rate: 2100, unit: "sqft", name: "12mm Ply" },
    "fluted_panel": { rate: 2100, unit: "sqft", name: "Fluted Panel" },
    "marine_ply_acrylic": { rate: 3500, unit: "sqft", name: "16mm Marine Ply Acrylic Finish" },
    "marine_ply_rehau": { rate: 3500, unit: "sqft", name: "16mm Marine Ply Rehau Finish" },
    "marine_ply_laminate": { rate: 3000, unit: "sqft", name: "16mm Marine Ply Laminate Finish" }
  };

  let selectedRate = "ply_laminate_12mm";
  let selectedUnit = "ft";

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
    // Set current date
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-IN', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    
    // Select default rate
    selectRate('ply_laminate_12mm');
    
    // Initialize measurement inputs
    updateMeasurementInputs();
    
    // Add input event listeners for real-time validation
    document.getElementById('length').addEventListener('input', function() {
      clearErrors('length');
      validateMeasurement('length');
    });
    document.getElementById('width').addEventListener('input', function() {
      clearErrors('width');
      validateMeasurement('width');
    });
  });

  function selectRate(rate) {
    selectedRate = rate;
    
    // Remove selected class from all options
    document.querySelectorAll('.rate-option').forEach(option => {
      option.classList.remove('selected');
    });
    
    // Add selected class to clicked option
    document.querySelector(`[data-rate="${rate}"]`).classList.add('selected');
    
    // Show/hide custom rate input
    const customRateInput = document.getElementById('customRateInput');
    if (rate === 'custom') {
      customRateInput.classList.add('show');
    } else {
      customRateInput.classList.remove('show');
    }
    
    // Update unit options based on material type
    updateUnitOptions();
  }

  function updateUnitOptions() {
    const unitOptionsContainer = document.getElementById('unitOptions');
    const materialInfo = selectedRate === 'custom' ? 
      { unit: document.getElementById('customRateUnit')?.value || 'sqft' } : 
      rateMapping[selectedRate];
    
    let availableUnits = [];
    
    if (materialInfo.unit === 'running_ft') {
      availableUnits = [
        { value: 'ft', label: 'Running Feet (ft)', icon: '📏', examples: '5ft, 5\'10", 5ft 10in', type: 'linear' },
        { value: 'm', label: 'Running Meters (m)', icon: '📐', examples: '2.5m, 1.8m', type: 'linear' }
      ];
    } else {
      availableUnits = [
        { value: 'ft', label: 'Square Feet (sq.ft)', icon: '📐', examples: '5ft, 5\'10", 5ft 10in', type: 'area' },
        { value: 'm', label: 'Square Meters (sq.m)', icon: '📏', examples: '2.5m, 1.8m', type: 'area' },
        { value: 'cm', label: 'Square Centimeters (sq.cm)', icon: '📏', examples: '150cm, 120cm', type: 'area' },
        { value: 'mm', label: 'Square Millimeters (sq.mm)', icon: '📏', examples: '1500mm, 1200mm', type: 'area' },
        { value: 'running_ft', label: 'Running Feet (ft)', icon: '📏', examples: '5ft, 5\'10", 5ft 10in', type: 'linear' }
      ];
    }
    
    unitOptionsContainer.innerHTML = availableUnits.map(unit => 
      `<div class="unit-option ${unit.value === selectedUnit ? 'selected' : ''}" 
            onclick="selectUnit('${unit.value}')" 
            title="Examples: ${unit.examples} (${unit.type === 'linear' ? 'Linear measurement' : 'Area measurement'})"
            data-type="${unit.type}">
         ${unit.icon} ${unit.label}
       </div>`
    ).join('');
  }

  function selectUnit(unit) {
    selectedUnit = unit;
    
    // Update selected class
    document.querySelectorAll('.unit-option').forEach(option => {
      option.classList.remove('selected');
    });
    event.target.classList.add('selected');
    
    // Update placeholders and hints based on selected unit
    updateInputPlaceholders();
    
    // Show/hide width input based on unit type
    updateMeasurementInputs();
    
    // Clear any existing errors
    clearErrors('length');
    clearErrors('width');
  }

  function updateMeasurementInputs() {
    const widthContainer = document.getElementById('widthContainer');
    const widthInput = document.getElementById('width');
    const widthHint = document.getElementById('widthHint');
    
    if (selectedUnit === 'running_ft') {
      // Gray out width for running feet
      widthContainer.classList.add('disabled-field');
      widthInput.value = ''; // Clear width value
      widthHint.textContent = 'Width not needed for running feet';
    } else {
      // Enable width for area measurements
      widthContainer.classList.remove('disabled-field');
      widthHint.textContent = `Enter width in ${selectedUnit === 'ft' ? 'square feet' : selectedUnit === 'm' ? 'square meters' : selectedUnit === 'cm' ? 'square centimeters' : 'square millimeters'}`;
    }
  }

  function updateInputPlaceholders() {
    const lengthInput = document.getElementById('length');
    const widthInput = document.getElementById('width');
    const lengthHint = document.getElementById('lengthHint');
    const widthHint = document.getElementById('widthHint');
    
    const examples = {
      'ft': '5ft, 5\'10", 5ft 10in',
      'm': '2.5m, 1.8m',
      'cm': '150cm, 120cm',
      'mm': '1500mm, 1200mm',
      'running_ft': '5ft, 5\'10", 5ft 10in'
    };
    
    const unitLabels = {
      'ft': 'square feet',
      'm': 'square meters',
      'cm': 'square centimeters',
      'mm': 'square millimeters',
      'running_ft': 'running feet'
    };
    
    lengthInput.placeholder = `e.g., ${examples[selectedUnit]}`;
    widthInput.placeholder = `e.g., ${examples[selectedUnit]}`;
    lengthHint.textContent = `Enter length in ${unitLabels[selectedUnit]}`;
    widthHint.textContent = `Enter width in ${unitLabels[selectedUnit]}`;
  }

  // Unit-specific measurement parser
  function parseMeasurement(input, targetUnit) {
    if (!input || typeof input !== 'string') return { value: 0, error: 'Invalid input' };
    
    const cleanInput = input.trim().toLowerCase();
    
    // Unit-specific patterns
    const patterns = {
      'ft': [
        // Feet and inches: 5ft 10in, 5'10", 5 feet 10 inches, 5 ft 10 in, 10' 11''
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')\s*(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) + parseFloat(match[2]) / 12 },
        // Feet only: 5ft, 5', 5 feet
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')/i, 
          handler: (match) => parseFloat(match[1]) },
        // Inches only: 10in, 10", 10 inches
        { regex: /(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) / 12 },
        // Pure numbers (assume feet)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'm': [
        // Meters: 2.5m, 2.5 meters
        { regex: /(\d+(?:\.\d+)?)\s*(?:m|meters?)/i, 
          handler: (match) => parseFloat(match[1]) },
        // Pure numbers (assume meters)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'cm': [
        // Centimeters: 150cm, 150 centimeters
        { regex: /(\d+(?:\.\d+)?)\s*(?:cm|centimeters?)/i, 
          handler: (match) => parseFloat(match[1]) },
        // Pure numbers (assume cm)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'mm': [
        // Millimeters: 1500mm, 1500 millimeters
        { regex: /(\d+(?:\.\d+)?)\s*(?:mm|millimeters?)/i, 
          handler: (match) => parseFloat(match[1]) },
        // Pure numbers (assume mm)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ],
      'running_ft': [
        // Feet and inches: 5ft 10in, 5'10", 5 feet 10 inches, 5 ft 10 in, 10' 11''
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')\s*(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) + parseFloat(match[2]) / 12 },
        // Feet only: 5ft, 5', 5 feet
        { regex: /(\d+(?:\.\d+)?)\s*(?:ft|feet|')/i, 
          handler: (match) => parseFloat(match[1]) },
        // Inches only: 10in, 10", 10 inches
        { regex: /(\d+(?:\.\d+)?)\s*(?:in|inch|inches|"|'')/i, 
          handler: (match) => parseFloat(match[1]) / 12 },
        // Pure numbers (assume feet)
        { regex: /^(\d+(?:\.\d+)?)$/, 
          handler: (match) => parseFloat(match[1]) }
      ]
    };
    
    const unitPatterns = patterns[targetUnit] || patterns['ft'];
    
    for (const pattern of unitPatterns) {
      const match = cleanInput.match(pattern.regex);
      if (match) {
        const value = pattern.handler(match);
        if (!isNaN(value) && value > 0) {
          return { value, error: null };
        }
      }
    }
    
    const examples = {
      'ft': '5ft, 5\'10", 5ft 10in, 10in',
      'm': '2.5m, 1.8m',
      'cm': '150cm, 120cm',
      'mm': '1500mm, 1200mm',
      'running_ft': '5ft, 5\'10", 5ft 10in, 10in'
    };
    
    return { 
      value: 0, 
      error: `Invalid format. Try: ${examples[targetUnit]}` 
    };
  }

  function clearErrors(field) {
    const input = document.getElementById(field);
    const wrapper = input.parentElement;
    const hint = wrapper.parentElement.querySelector('.input-hint');
    
    // Remove error styling
    wrapper.classList.remove('error');
    
    // Remove error message
    const existingError = wrapper.parentElement.querySelector('.error-message');
    if (existingError) {
      existingError.remove();
    }
    
    // Reset hint based on field and unit
    if (field === 'width' && selectedUnit === 'running_ft') {
      hint.textContent = 'Width not needed for running feet';
      hint.style.color = '#6c757d';
    } else {
      const unitLabels = {
        'ft': 'square feet',
        'm': 'square meters',
        'cm': 'square centimeters',
        'mm': 'square millimeters',
        'running_ft': 'running feet'
      };
      hint.textContent = `Enter ${field} in ${unitLabels[selectedUnit]}`;
      hint.style.color = '#64748b';
    }
  }

  function validateMeasurement(field) {
    const input = document.getElementById(field);
    const value = input.value;
    
    // Skip validation if width field is disabled (running feet)
    if (field === 'width' && selectedUnit === 'running_ft') {
      return true;
    }
    
    if (!value.trim()) {
      return true; // Empty is valid
    }
    
    const result = parseMeasurement(value, selectedUnit);
    
    if (result.error) {
      // Add error styling
      input.parentElement.classList.add('error');
      
      // Add error message
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message show';
      errorDiv.textContent = result.error;
      input.parentElement.parentElement.appendChild(errorDiv);
      
      return false;
    } else {
      // Show success hint
      const hint = input.parentElement.parentElement.querySelector('.input-hint');
      hint.textContent = `✓ Parsed as ${result.value.toFixed(2)} ${selectedUnit}`;
      hint.style.color = '#059669';
      
      return true;
    }
  }

  // Convert any unit to feet
  function convertToFeet(value, unit) {
    const conversions = {
      "mm": value / 304.8,      // 1 foot = 304.8 mm
      "cm": value / 30.48,      // 1 foot = 30.48 cm
      "in": value / 12,         // 1 foot = 12 inches
      "ft": value,              // already in feet
      "running_ft": value       // running feet are the same as regular feet
    };
    return conversions[unit] || value;
  }

  // Convert any unit to meters
  function convertToMeters(value, unit) {
    const conversions = {
      "mm": value / 1000,       // 1 meter = 1000 mm
      "cm": value / 100,        // 1 meter = 100 cm
      "in": value * 0.0254,     // 1 inch = 0.0254 meters
      "ft": value * 0.3048      // 1 foot = 0.3048 meters
    };
    return conversions[unit] || value;
  }

  function generateQuote() {
    // Parse measurements using unit-specific parser
    const lengthInput = document.getElementById("length").value;
    const widthInput = document.getElementById("width").value;
    
    const lengthResult = parseMeasurement(lengthInput, selectedUnit);
    const widthResult = parseMeasurement(widthInput, selectedUnit);
    
    // Check for parsing errors
    if (lengthResult.error) {
      alert(`Length error: ${lengthResult.error}`);
      return;
    }
    if (widthResult.error) {
      alert(`Width error: ${widthResult.error}`);
      return;
    }
    
    // Get parsed values in the selected unit
    const lengthInUnit = lengthResult.value;
    const widthInUnit = selectedUnit === 'running_ft' ? 0 : widthResult.value; // No width for running feet
    
    if (lengthInUnit <= 0) {
      alert("Please enter a valid length greater than zero.");
      return;
    }
    
    if (selectedUnit !== 'running_ft' && widthInUnit <= 0) {
      alert("Please enter a valid width greater than zero.");
      return;
    }
    
    // Get material info for unit validation
    let materialInfo;
    if (selectedRate === "custom") {
      const customRate = parseFloat(document.getElementById("customRate").value);
      const customRateUnit = document.getElementById("customRateUnit").value;
      const customMaterialName = document.getElementById("customMaterialName").value;
      
      if (isNaN(customRate) || customRate <= 0) {
        alert("Please enter a valid custom rate.");
        return;
      }
      
      materialInfo = {
        rate: customRate,
        unit: customRateUnit,
        name: customMaterialName || "Custom Material"
      };
    } else {
      materialInfo = rateMapping[selectedRate];
    }
    
    // Smart unit validation
    const isLinearUnit = selectedUnit === 'running_ft' || selectedUnit === 'm';
    const isAreaUnit = ['ft', 'm', 'cm', 'mm'].includes(selectedUnit) && selectedUnit !== 'running_ft';
    
    if (materialInfo.unit === 'running_ft' && !isLinearUnit) {
      alert(`❌ Unit Mismatch!\n\nThis material (${materialInfo.name}) is priced per running foot, but you selected an area unit (${selectedUnit}).\n\nPlease select "Running Feet" or "Running Meters" for linear measurements.`);
      return;
    }
    
    if (materialInfo.unit !== 'running_ft' && isLinearUnit) {
      alert(`❌ Unit Mismatch!\n\nThis material (${materialInfo.name}) is priced per square foot, but you selected a linear unit (${selectedUnit}).\n\nPlease select an area unit like "Square Feet" or "Square Meters" for area measurements.`);
      return;
    }
    
    // Convert to feet for calculations
    const lengthFt = convertToFeet(lengthInUnit, selectedUnit);
    const widthFt = convertToFeet(widthInUnit, selectedUnit);

    // Calculate areas
    const areaSqft = lengthFt * widthFt;
    const areaSqm = areaSqft / 10.7639; // Convert to square meters

    let cost, calculationMethod, ratePerSqft;
    
    if (materialInfo.unit === "running_ft") {
      // For running feet materials (like beading), use length only
      cost = lengthFt * materialInfo.rate;
      calculationMethod = `Length: ${lengthFt.toFixed(2)} ft × ₹${materialInfo.rate.toLocaleString()}/ft`;
      ratePerSqft = materialInfo.rate; // For display purposes
    } else if (materialInfo.unit === "sqm") {
      // Convert sq.m rate to sq.ft rate for calculation
      ratePerSqft = materialInfo.rate * 10.7639; // 1 sq.m = 10.7639 sq.ft
      cost = areaSqft * ratePerSqft;
      calculationMethod = `Area: ${areaSqft.toFixed(2)} sq.ft × ₹${ratePerSqft.toFixed(2)}/sq.ft (converted from ₹${materialInfo.rate.toLocaleString()}/sq.m)`;
    } else {
      // For square feet materials
      cost = areaSqft * materialInfo.rate;
      calculationMethod = `Area: ${areaSqft.toFixed(2)} sq.ft × ₹${materialInfo.rate.toLocaleString()}/sq.ft`;
      ratePerSqft = materialInfo.rate;
    }

    // Update quote details
    const quoteDetails = document.getElementById('quoteDetails');
    quoteDetails.innerHTML = `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-cube"></i> Material</span>
        <span class="detail-value">${materialInfo.name}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-ruler-horizontal"></i> Length</span>
        <span class="detail-value">${lengthInUnit.toFixed(2)} ${selectedUnit}</span>
      </div>
      ${selectedUnit !== 'running_ft' ? `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-ruler-vertical"></i> Width</span>
        <span class="detail-value">${widthInUnit.toFixed(2)} ${selectedUnit}</span>
      </div>
      ` : ''}
      ${materialInfo.unit === 'running_ft' ? `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-ruler-combined"></i> Length</span>
        <span class="detail-value">${lengthFt.toFixed(2)} ft</span>
      </div>
      ` : materialInfo.unit === 'sqm' ? `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-expand-arrows-alt"></i> Area</span>
        <span class="detail-value">${areaSqm.toFixed(2)} sq.m</span>
      </div>
      ` : `
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-expand-arrows-alt"></i> Area</span>
        <span class="detail-value">${areaSqft.toFixed(2)} sq.ft</span>
      </div>
      `}
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-tag"></i> Rate</span>
        <span class="detail-value">₹${materialInfo.rate.toLocaleString()}/${materialInfo.unit === 'running_ft' ? 'ft' : materialInfo.unit === 'sqm' ? 'sq.m' : 'sq.ft'}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-calculator"></i> Calculation</span>
        <span class="detail-value">${calculationMethod}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label"><i class="fas fa-info-circle"></i> Input</span>
        <span class="detail-value">
          Length: ${lengthInput}${selectedUnit !== 'running_ft' ? `<br>Width: ${widthInput}` : ''}<br>
          <small style="color: #64748b;">(${selectedUnit})</small>
        </span>
      </div>
    `;

    // Update total section
    const totalSection = document.getElementById('totalSection');
    totalSection.innerHTML = `
      <h4>₹${cost.toLocaleString()}</h4>
      <p>Total Cost</p>
    `;

    // Show quote box with animation
    const quoteBox = document.getElementById('quoteBox');
    quoteBox.classList.remove('hidden');
    quoteBox.classList.add('fade-in');
  }

  function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const quoteBox = document.getElementById("quoteBox");
    if (quoteBox.classList.contains('hidden')) {
      alert("Please generate a quotation first!");
      return;
    }

    // Add company header
    doc.setFontSize(20);
    doc.text("Professional Material Quotation", 20, 20);
    
    doc.setFontSize(12);
    doc.text("Generated on: " + new Date().toLocaleDateString('en-IN'), 20, 30);
    
    // Add line
    doc.line(20, 35, 190, 35);
    
    // Add quote details
    let yPosition = 50;
    const details = quoteBox.querySelectorAll('.detail-row');
    
    details.forEach(detail => {
      const label = detail.querySelector('.detail-label').textContent;
      const value = detail.querySelector('.detail-value').textContent;
      
      doc.setFontSize(11);
      doc.text(label + ":", 20, yPosition);
      doc.text(value, 120, yPosition);
      yPosition += 8;
    });
    
    // Add total
    yPosition += 10;
    doc.setFontSize(16);
    doc.text("TOTAL COST:", 20, yPosition);
    const totalValue = quoteBox.querySelector('.total-section h4').textContent;
    doc.text(totalValue, 120, yPosition);
    
    // Add footer
    doc.setFontSize(10);
    doc.text("Thank you for your business!", 20, 280);
    
    doc.save("material_quotation.pdf");
  }
</script>
</body>
</html>
